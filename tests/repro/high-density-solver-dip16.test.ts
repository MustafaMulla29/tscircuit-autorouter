import { test, expect } from "bun:test"
import { JumperHighDensitySolver } from "lib/autorouter-pipelines/AssignableAutoroutingPipeline2/JumperHighDensitySolver"
import { getLastStepSvg } from "../fixtures/getLastStepSvg"
import { getSvgFromGraphicsObject } from "graphics-debug"
import type { NodeWithPortPoints } from "lib/types/high-density-types"

const nodePortPoints: NodeWithPortPoints[] = [
  {
    capacityMeshNodeId: "cmn_0",
    center: {
      x: 0,
      y: 0,
    },
    width: 12.399999999999999,
    height: 22,
    portPoints: [
      {
        portPointId: "ce13_pp1_z0",
        x: -6.199999999999999,
        y: 6.158333333333334,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce31_pp0_z0",
        x: 6.199999999999999,
        y: 7.375,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce16_pp1_z0",
        x: -6.199999999999999,
        y: 10.344999999999999,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce32_pp1_z0",
        x: 6.199999999999999,
        y: 8.698333333333334,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce11_pp2_z0",
        x: -6.199999999999999,
        y: 1.461666666666667,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
      {
        portPointId: "ce24_pp1_z0",
        x: 6.199999999999999,
        y: -1.461666666666667,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
      {
        portPointId: "ce9_pp1_z0",
        x: -6.199999999999999,
        y: -4.001666666666665,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
      {
        portPointId: "ce28_pp1_z0",
        x: 6.199999999999999,
        y: 3.6183333333333323,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
      {
        portPointId: "ce15_pp1_z0",
        x: -6.199999999999999,
        y: 8.698333333333334,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce31_pp1_z0",
        x: 6.199999999999999,
        y: 7.865,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce12_pp1_z0",
        x: -6.199999999999999,
        y: 3.618333333333334,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce29_pp0_z0",
        x: 6.199999999999999,
        y: 4.834999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce10_pp1_z0",
        x: -6.199999999999999,
        y: -1.461666666666666,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
      {
        portPointId: "ce26_pp2_z0",
        x: 6.199999999999999,
        y: 1.461666666666666,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
      {
        portPointId: "ce8_pp1_z0",
        x: -6.199999999999999,
        y: -6.541666666666666,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
      {
        portPointId: "ce30_pp1_z0",
        x: 6.199999999999999,
        y: 6.158333333333333,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_1",
    center: {
      x: -7.6,
      y: 2.5400000000000005,
    },
    width: 2.8000000000000007,
    height: 0.9400000000000004,
    portPoints: [
      {
        portPointId: "ce34_pp0_z0",
        x: -8.775,
        y: 2.0700000000000003,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce35_pp0_z0",
        x: -8.775,
        y: 3.0100000000000007,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_2",
    center: {
      x: -7.6,
      y: -2.539999999999999,
    },
    width: 2.8000000000000007,
    height: 0.9399999999999995,
    portPoints: [
      {
        portPointId: "ce38_pp0_z0",
        x: -8.775,
        y: -3.009999999999999,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce39_pp0_z0",
        x: -8.775,
        y: -2.0699999999999994,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_3",
    center: {
      x: -7.6,
      y: 5.080000000000001,
    },
    width: 2.8000000000000007,
    height: 0.9399999999999995,
    portPoints: [
      {
        portPointId: "ce42_pp2_z0",
        x: -8.025,
        y: 4.610000000000001,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce43_pp2_z0",
        x: -8.025,
        y: 5.550000000000001,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_4",
    center: {
      x: -7.6,
      y: -5.079999999999998,
    },
    width: 2.8000000000000007,
    height: 0.9400000000000004,
    portPoints: [
      {
        portPointId: "ce46_pp1_z0",
        x: -8.4,
        y: -5.549999999999998,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce47_pp1_z0",
        x: -8.4,
        y: -4.609999999999998,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_5",
    center: {
      x: 7.6,
      y: -3.3306690738754696e-16,
    },
    width: 2.8000000000000007,
    height: 0.9399999999999997,
    portPoints: [
      {
        portPointId: "ce53_pp1_z0",
        x: 8.4,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce52_pp1_z0",
        x: 8.4,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce53_pp2_z0",
        x: 8.775,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce52_pp2_z0",
        x: 8.775,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce53_pp0_z0",
        x: 8.025,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce52_pp0_z0",
        x: 8.025,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_6",
    center: {
      x: -7.6,
      y: 5.551115123125783e-16,
    },
    width: 2.8000000000000007,
    height: 0.9399999999999997,
    portPoints: [
      {
        portPointId: "ce54_pp0_z0",
        x: -8.775,
        y: -0.4699999999999993,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce55_pp0_z0",
        x: -8.775,
        y: 0.4700000000000005,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_7",
    center: {
      x: 7.6,
      y: -2.54,
    },
    width: 2.8000000000000007,
    height: 0.9400000000000004,
    portPoints: [
      {
        portPointId: "ce61_pp1_z0",
        x: 8.4,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce60_pp1_z0",
        x: 8.4,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce61_pp2_z0",
        x: 8.775,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce60_pp2_z0",
        x: 8.775,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce61_pp0_z0",
        x: 8.025,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce58_pp1_z0",
        x: 6.808333333333334,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_8",
    center: {
      x: 7.6,
      y: 2.539999999999999,
    },
    width: 2.8000000000000007,
    height: 0.9399999999999995,
    portPoints: [
      {
        portPointId: "ce65_pp1_z0",
        x: 8.4,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce64_pp1_z0",
        x: 8.4,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce65_pp2_z0",
        x: 8.775,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce64_pp2_z0",
        x: 8.775,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce65_pp0_z0",
        x: 8.025,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce64_pp0_z0",
        x: 8.025,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_9",
    center: {
      x: 7.6,
      y: -5.08,
    },
    width: 2.8000000000000007,
    height: 0.9400000000000004,
    portPoints: [
      {
        portPointId: "ce69_pp1_z0",
        x: 8.4,
        y: -4.609999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce66_pp1_z0",
        x: 6.808333333333334,
        y: -5.550000000000001,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce69_pp2_z0",
        x: 8.775,
        y: -4.609999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce68_pp1_z0",
        x: 8.4,
        y: -5.549999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_10",
    center: {
      x: 7.6,
      y: 5.08,
    },
    width: 2.8000000000000007,
    height: 0.9400000000000004,
    portPoints: [
      {
        portPointId: "ce73_pp1_z0",
        x: 8.4,
        y: 5.55,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce72_pp1_z0",
        x: 8.4,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce73_pp2_z0",
        x: 8.775,
        y: 5.55,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce72_pp2_z0",
        x: 8.775,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce29_pp0_z0",
        x: 6.199999999999999,
        y: 4.834999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce72_pp0_z0",
        x: 8.025,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_12",
    center: {
      x: 8.4,
      y: -8.274999999999999,
    },
    width: 1.1999999999999993,
    height: 5.450000000000001,
    portPoints: [
      {
        portPointId: "ce68_pp1_z0",
        x: 8.4,
        y: -5.549999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce77_pp1_z0",
        x: 7.800000000000001,
        y: -9.081666666666667,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_13",
    center: {
      x: -8.4,
      y: -7.349999999999998,
    },
    width: 1.2000000000000002,
    height: 3.6000000000000005,
    portPoints: [
      {
        portPointId: "ce82_pp0_z0",
        x: -7.800000000000001,
        y: -7.865000000000002,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce46_pp1_z0",
        x: -8.4,
        y: -5.549999999999998,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_14",
    center: {
      x: -8.4,
      y: 8.98125,
    },
    width: 1.2000000000000002,
    height: 4.0375000000000005,
    portPoints: [
      {
        portPointId: "ce84_pp2_z0",
        x: -8.025,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce88_pp2_z0",
        x: -7.800000000000001,
        y: 10.775,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_16",
    center: {
      x: 8.4,
      y: 8.98125,
    },
    width: 1.1999999999999993,
    height: 4.0375000000000005,
    portPoints: [
      {
        portPointId: "ce91_pp0_z0",
        x: 7.800000000000001,
        y: 7.375,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce94_pp1_z0",
        x: 8.4,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce91_pp1_z0",
        x: 7.800000000000001,
        y: 7.865,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce94_pp2_z0",
        x: 8.775,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_18",
    center: {
      x: -8.4,
      y: -1.2699999999999994,
    },
    width: 1.2000000000000002,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce39_pp0_z0",
        x: -8.775,
        y: -2.0699999999999994,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce54_pp0_z0",
        x: -8.775,
        y: -0.4699999999999993,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_19",
    center: {
      x: -8.4,
      y: 1.2700000000000005,
    },
    width: 1.2000000000000002,
    height: 1.5999999999999999,
    portPoints: [
      {
        portPointId: "ce55_pp0_z0",
        x: -8.775,
        y: 0.4700000000000005,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce34_pp0_z0",
        x: -8.775,
        y: 2.0700000000000003,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_20",
    center: {
      x: -8.4,
      y: 6.2562500000000005,
    },
    width: 1.2000000000000002,
    height: 1.4124999999999996,
    portPoints: [
      {
        portPointId: "ce43_pp2_z0",
        x: -8.025,
        y: 5.550000000000001,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce84_pp2_z0",
        x: -8.025,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_21",
    center: {
      x: -8.4,
      y: 3.810000000000001,
    },
    width: 1.2000000000000002,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce35_pp0_z0",
        x: -8.775,
        y: 3.0100000000000007,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce42_pp2_z0",
        x: -8.025,
        y: 4.610000000000001,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_22",
    center: {
      x: -8.4,
      y: -3.8099999999999987,
    },
    width: 1.2000000000000002,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce47_pp1_z0",
        x: -8.4,
        y: -4.609999999999998,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce38_pp0_z0",
        x: -8.775,
        y: -3.009999999999999,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_23",
    center: {
      x: -7,
      y: -7.620000000000001,
    },
    width: 1.6000000000000014,
    height: 0.9400000000000022,
    portPoints: [
      {
        portPointId: "ce101_pp1_z0",
        x: -7.191666666666666,
        y: -8.09,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce82_pp0_z0",
        x: -7.800000000000001,
        y: -7.865000000000002,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_26",
    center: {
      x: 7,
      y: 7.62,
    },
    width: 1.6000000000000014,
    height: 0.9399999999999995,
    portPoints: [
      {
        portPointId: "ce31_pp0_z0",
        x: 6.199999999999999,
        y: 7.375,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce91_pp0_z0",
        x: 7.800000000000001,
        y: 7.375,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce31_pp1_z0",
        x: 6.199999999999999,
        y: 7.865,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce91_pp1_z0",
        x: 7.800000000000001,
        y: 7.865,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_27",
    center: {
      x: 8.4,
      y: -3.8100000000000005,
    },
    width: 1.1999999999999993,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce60_pp1_z0",
        x: 8.4,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce69_pp1_z0",
        x: 8.4,
        y: -4.609999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce60_pp2_z0",
        x: 8.775,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce69_pp2_z0",
        x: 8.775,
        y: -4.609999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_28",
    center: {
      x: 8.4,
      y: -1.2700000000000002,
    },
    width: 1.1999999999999993,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce52_pp1_z0",
        x: 8.4,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce61_pp1_z0",
        x: 8.4,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce52_pp2_z0",
        x: 8.775,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce61_pp2_z0",
        x: 8.775,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce52_pp0_z0",
        x: 8.025,
        y: -0.4700000000000002,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce61_pp0_z0",
        x: 8.025,
        y: -2.0700000000000003,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_29",
    center: {
      x: 8.4,
      y: 1.2699999999999996,
    },
    width: 1.1999999999999993,
    height: 1.5999999999999999,
    portPoints: [
      {
        portPointId: "ce64_pp1_z0",
        x: 8.4,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce53_pp1_z0",
        x: 8.4,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce64_pp2_z0",
        x: 8.775,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce53_pp2_z0",
        x: 8.775,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce64_pp0_z0",
        x: 8.025,
        y: 2.0699999999999994,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce53_pp0_z0",
        x: 8.025,
        y: 0.4699999999999996,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_30",
    center: {
      x: 8.4,
      y: 3.809999999999999,
    },
    width: 1.1999999999999993,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce72_pp1_z0",
        x: 8.4,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce65_pp1_z0",
        x: 8.4,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce72_pp2_z0",
        x: 8.775,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce65_pp2_z0",
        x: 8.775,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce72_pp0_z0",
        x: 8.025,
        y: 4.609999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        portPointId: "ce65_pp0_z0",
        x: 8.025,
        y: 3.009999999999999,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_31",
    center: {
      x: 8.4,
      y: 6.25625,
    },
    width: 1.1999999999999993,
    height: 1.4125000000000005,
    portPoints: [
      {
        portPointId: "ce94_pp1_z0",
        x: 8.4,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce73_pp1_z0",
        x: 8.4,
        y: 5.55,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        portPointId: "ce94_pp2_z0",
        x: 8.775,
        y: 6.9624999999999995,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        portPointId: "ce73_pp2_z0",
        x: 8.775,
        y: 5.55,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_32",
    center: {
      x: -7,
      y: 10.344999999999999,
    },
    width: 1.6000000000000014,
    height: 1.3100000000000023,
    portPoints: [
      {
        portPointId: "ce88_pp2_z0",
        x: -7.800000000000001,
        y: 10.775,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        portPointId: "ce16_pp1_z0",
        x: -6.199999999999999,
        y: 10.344999999999999,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_34",
    center: {
      x: -7,
      y: 8.89,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce15_pp1_z0",
        x: -6.199999999999999,
        y: 8.698333333333334,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        x: -7,
        y: 8.89,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_35",
    center: {
      x: -7,
      y: 6.3500000000000005,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce13_pp1_z0",
        x: -6.199999999999999,
        y: 6.158333333333334,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        x: -7,
        y: 6.3500000000000005,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_36",
    center: {
      x: -7,
      y: 3.810000000000001,
    },
    width: 1.6000000000000005,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce12_pp1_z0",
        x: -6.199999999999999,
        y: 3.618333333333334,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        x: -7,
        y: 3.8100000000000005,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_37",
    center: {
      x: -7,
      y: 1.2700000000000005,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999999,
    portPoints: [
      {
        portPointId: "ce11_pp2_z0",
        x: -6.199999999999999,
        y: 1.461666666666667,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
      {
        x: -7,
        y: 1.2700000000000005,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_38",
    center: {
      x: -7,
      y: -1.2699999999999994,
    },
    width: 1.6000000000000005,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce10_pp1_z0",
        x: -6.199999999999999,
        y: -1.461666666666666,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
      {
        x: -7,
        y: -1.2699999999999996,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_39",
    center: {
      x: -7,
      y: -3.8099999999999987,
    },
    width: 1.6000000000000005,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce9_pp1_z0",
        x: -6.199999999999999,
        y: -4.001666666666665,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
      {
        x: -7,
        y: -3.8099999999999987,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_40",
    center: {
      x: -7,
      y: -6.35,
    },
    width: 1.6000000000000005,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce8_pp1_z0",
        x: -6.199999999999999,
        y: -6.541666666666666,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
      {
        x: -7,
        y: -6.35,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_41",
    center: {
      x: -7,
      y: -8.89,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce101_pp1_z0",
        x: -7.191666666666666,
        y: -8.09,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        x: -7,
        y: -8.89,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_42",
    center: {
      x: 7,
      y: -8.89,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce77_pp1_z0",
        x: 7.800000000000001,
        y: -9.081666666666667,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
      {
        x: 7,
        y: -8.89,
        z: 0,
        connectionName: "source_trace_0",
        rootConnectionName: "source_trace_0",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_43",
    center: {
      x: 7,
      y: -6.3500000000000005,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce66_pp1_z0",
        x: 6.808333333333334,
        y: -5.550000000000001,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
      {
        x: 7,
        y: -6.3500000000000005,
        z: 0,
        connectionName: "source_trace_1",
        rootConnectionName: "source_trace_1",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_44",
    center: {
      x: 7,
      y: -3.8100000000000005,
    },
    width: 1.6000000000000005,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce58_pp1_z0",
        x: 6.808333333333334,
        y: -3.0100000000000007,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
      {
        x: 7,
        y: -3.8100000000000005,
        z: 0,
        connectionName: "source_trace_2",
        rootConnectionName: "source_trace_2",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_45",
    center: {
      x: 7,
      y: -1.2700000000000002,
    },
    width: 1.6000000000000005,
    height: 1.6,
    portPoints: [
      {
        portPointId: "ce24_pp1_z0",
        x: 6.199999999999999,
        y: -1.461666666666667,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
      {
        x: 7,
        y: -1.2700000000000005,
        z: 0,
        connectionName: "source_trace_3",
        rootConnectionName: "source_trace_3",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_46",
    center: {
      x: 7,
      y: 1.2699999999999996,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999999,
    portPoints: [
      {
        portPointId: "ce26_pp2_z0",
        x: 6.199999999999999,
        y: 1.461666666666666,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
      {
        x: 7,
        y: 1.2699999999999996,
        z: 0,
        connectionName: "source_trace_4",
        rootConnectionName: "source_trace_4",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_47",
    center: {
      x: 7,
      y: 3.809999999999999,
    },
    width: 1.6000000000000005,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce28_pp1_z0",
        x: 6.199999999999999,
        y: 3.6183333333333323,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
      {
        x: 7,
        y: 3.8099999999999987,
        z: 0,
        connectionName: "source_trace_5",
        rootConnectionName: "source_trace_5",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_48",
    center: {
      x: 7,
      y: 6.35,
    },
    width: 1.6000000000000005,
    height: 1.6000000000000005,
    portPoints: [
      {
        portPointId: "ce30_pp1_z0",
        x: 6.199999999999999,
        y: 6.158333333333333,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
      {
        x: 7,
        y: 6.35,
        z: 0,
        connectionName: "source_trace_6",
        rootConnectionName: "source_trace_6",
      },
    ],
    availableZ: [0],
  },
  {
    capacityMeshNodeId: "cmn_49",
    center: {
      x: 7,
      y: 8.89,
    },
    width: 1.6000000000000005,
    height: 1.5999999999999996,
    portPoints: [
      {
        portPointId: "ce32_pp1_z0",
        x: 6.199999999999999,
        y: 8.698333333333334,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
      {
        x: 7,
        y: 8.89,
        z: 0,
        connectionName: "source_trace_7",
        rootConnectionName: "source_trace_7",
      },
    ],
    availableZ: [0],
  },
]

const colorMap = {
  connectivity_net7: "hsl(0, 100%, 50%)",
  source_trace_7: "hsl(0, 100%, 50%)",
  connectivity_net6: "hsl(37.5, 100%, 50%)",
  source_trace_6: "hsl(37.5, 100%, 50%)",
  connectivity_net5: "hsl(75, 100%, 50%)",
  source_trace_5: "hsl(75, 100%, 50%)",
  connectivity_net4: "hsl(112.5, 100%, 50%)",
  source_trace_4: "hsl(112.5, 100%, 50%)",
  connectivity_net3: "hsl(150, 100%, 50%)",
  source_trace_3: "hsl(150, 100%, 50%)",
  connectivity_net2: "hsl(187.5, 100%, 50%)",
  source_trace_2: "hsl(187.5, 100%, 50%)",
  connectivity_net1: "hsl(225, 100%, 50%)",
  source_trace_1: "hsl(225, 100%, 50%)",
  connectivity_net0: "hsl(262.5, 100%, 50%)",
  source_trace_0: "hsl(262.5, 100%, 50%)",
}

test("high density solver with dip16-crossing data", () => {
  const solver = new JumperHighDensitySolver({
    nodePortPoints,
    colorMap,
    traceWidth: 0.15,
    viaDiameter: 0.6,
  })

  solver.solve()

  expect(solver.solved).toBe(true)
  expect(solver.routes.length).toBe(70)
  expect(solver.jumpers.length).toBeLessThanOrEqual(2)

  // Use getSvgFromGraphicsObject directly since the solver doesn't use step-based visualization
  const visualization = solver.visualize()
  const svgResult = getSvgFromGraphicsObject(visualization, {
    backgroundColor: "white",
  })

  expect(svgResult).toMatchSvgSnapshot(import.meta.path)
})
